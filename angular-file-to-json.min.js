/**
 * Upload various files to convert to JSON objects
 * @version v0.0.1
 * @link https://github.com/aburchette/angular-file-to-json
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
var ngFileToJson=angular.module("ngFileToJson",[]);ngFileToJson.directive("ngFileToJson",function(){"use strict";var module,splitColumns,createObject,cleanUpString,parseString,validTypes=["string","number","object","boolean","array"];return module={restrict:"E",transclude:!0,replace:!0,scope:{result:"=",headerField:"@headerField",typeField:"@typeField",delimiter:"@delimiter",rowDelimiter:"@rowDelimiter"},template:'<div><input ng-model="uploadFile" type="file"></div>',link:function(a,b){b.on("change",function(b){var c=new FileReader;c.readAsBinaryString(b.target.files[0]),c.onload=function(b){a.$apply(function(){a.result=createObject(b.target.result,a)})}})}},createObject=function(a,b){var c={headerField:"true",typeField:"false",delimiter:",",rowDelimiter:"\n"};c.headerField=b.headerField||c.headerField,c.typeField=b.typeField||c.typeField,c.delimiter=b.delimiter||c.delimiter,c.rowDelimiter=b.rowDelimiter||c.rowDelimiter;var d,e,f,g,h,i,j,k=[],l=[];if(c.headerField=c.headerField&&"true"===c.headerField?!0:!1,c.typeField=c.typeField&&"true"===c.typeField?!0:!1,d=cleanUpString(a).split(c.rowDelimiter),c.headerField&&(e=d.shift(),g=e.split(c.delimiter)),c.typeField)for(e=d.shift(),l=e.split(c.delimiter),i=0;i<l.length;i++)l[i]=-1===validTypes.indexOf(l[i].toLowerCase())?"string":l[i].toLowerCase();for(;d.length>0;)if(e=d.shift(),f=splitColumns(e,c.delimiter),g){for(h={},i=0;i<f.length;i++)l.length&&l[i]?(j=parseString(l[i],f[i]),h[g[i]||""]=j):h[g[i]||""]=f[i];k.push(h)}else{for(h=[],i=0;i<f.length;i++)j=parseString(l[i],f[i]),h.push(j);k.push(h)}return k},splitColumns=function(a,b){var c,d=a.split(""),e=!1,f=[],g=0,h=[];for(c=0;c<d.length;c++)'"'===d[c]&&(e=!e),e||d[c]!==b||f.push(c);if(f.length){for(c=0;c<f.length;c++)h.push(a.slice(g,f[c])),g=f[c]+1;h.push(a.slice(g,d.length))}return h},cleanUpString=function(a){var b,c=a.split("");for(b=c.length-1;b>=0;b--)"\r"===c[b]&&c.splice(b,1);return a=c.join(""),a=a.replace(/[\u2018\u2019\u201AÃ¢]/g,"'"),a=a.replace(/[\u201C\u201D\u201E]/g,'"'),a=a.replace(/\u2026/g,"..."),a=a.replace(/[\u2013\u2014]/g,"-"),a=a.replace(/\u02C6/g,"^"),a=a.replace(/\u2039/g,"<"),a=a.replace(/\u203A/g,">"),a=a.replace(/[\u02DC\u00A0]/g," ")},parseString=function(type,value){var obj,arr;switch(type){case"string":return String(value);case"number":return parseInt(value);case"object":if(value){value=value.replace(/^"|"$/g,"");try{obj=JSON.parse(JSON.stringify(eval("("+value+")")))}catch(e){return{}}return obj}return{};case"array":if(value){try{obj=[],value=value.replace(/^"?\[|\]"?$/g,""),arr=value.split(","),angular.forEach(arr,function(a){a.toLowerCase().indexOf("true")>-1||a.toLowerCase().indexOf("false")>-1?obj.push(parseString("boolean",a)):a.indexOf("{")>-1?obj.push(parseString("object",a)):a.indexOf("[")>-1?obj.push(parseString("array",a)):a.indexOf("'")>-1?(a=a.replace(/["']/g,""),obj.push(parseString("string",a))):a.match(/\d/)&&obj.push(parseString("number",a))})}catch(e){return[]}return obj}return[];case"boolean":return Boolean(value.toLowerCase());default:return String(value)}},module});